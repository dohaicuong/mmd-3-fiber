(this["webpackJsonpmmd-3-fiber"]=this["webpackJsonpmmd-3-fiber"]||[]).push([[0],{97:function(e,n,t){},98:function(e,n,t){"use strict";t.r(n);var r=t(5),i=t(1),a=t.n(i),c=t(33),o=t.n(c),s=t(70),u=t(18),d=t(11),l=t.n(d),f=t(20),m=t(4),j=t(41),h=t(53),p=t(6),b=t(0),v=t(28),x=function(){var e=Object(f.a)(l.a.mark((function e(n,t){var r,i,a,c,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new v.a,e.next=3,O(i,n);case 3:return a=e.sent,c=new b.AnimationMixer(a),e.next=7,Promise.all(null!==(r=null===t||void 0===t?void 0:t.map(function(){var e=Object(f.a)(l.a.mark((function e(n){var t,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(i,a,n.url);case 2:return t=e.sent,r=c.clipAction(t),e.abrupt("return",{name:n.name,animation:r});case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()))&&void 0!==r?r:[]);case 7:return o=e.sent,e.abrupt("return",{model:a,mixer:c,actions:o});case 9:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),O=function(e,n){return new Promise((function(t,r){e.load(n,(function(e){return t(e)}),(function(e){}),(function(e){return r(e)}))}))},w=function(e,n,t){return new Promise((function(r,i){e.loadAnimation(t,n,(function(e){return r(e)}),(function(e){}),(function(e){return i(e)}))}))},y=function(e){var n=Object(i.useState)({}),t=Object(p.a)(n,2),r=t[0],a=t[1];Object(i.useEffect)((function(){(function(){var n=Object(f.a)(l.a.mark((function n(){var t;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,x(e.modelUrl,e.motions);case 2:t=n.sent,a(t);case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}})()()}),[]);return Object(h.a)(Object(h.a)({},r),{},{playAction:function(e,n){var t,i,a=r.mixer,c=r.actions,o=null===c||void 0===c||null===(t=c.find((function(e){return e.name===n})))||void 0===t?void 0:t.animation,s=null===c||void 0===c||null===(i=c.find((function(n){return n.name===e})))||void 0===i?void 0:i.animation;if(!a||!s||!o)return null;!function(e,n,t){t.addEventListener("finished",(function(){n.reset().play()})),n.fadeOut(1),e.reset().setEffectiveTimeScale(1).setEffectiveWeight(1).fadeIn(1).setLoop(b.LoopOnce,0).play()}(s,o,a)}})},g=function(){return Object(r.jsxs)(m.a,{style:{width:"100vw",height:"100vh"},shadowMap:!0,pixelRatio:window.devicePixelRatio,camera:{position:[0,10,40]},children:[Object(r.jsx)("pointLight",{position:[0,6,0],intensity:.4,distance:10,decay:1}),Object(r.jsx)("spotLight",{color:"223344",position:[5,20,15],angle:.8,intensity:.7,penumbra:.8,castShadow:!0,shadowBias:-.001}),Object(r.jsx)(j.a,{}),Object(r.jsx)(j.c,{}),Object(r.jsx)(k,{})]})},k=function(){var e=y({modelUrl:"resources/miku_v2.pmd",motions:[{name:"idle",url:"resources/standing.vmd"},{name:"waving",url:"resources/waving.vmd"}]}),n=e.model,t=e.mixer,a=e.actions,c=e.playAction;!function(e){var n=e.model,t=e.actions;Object(i.useEffect)((function(){var e;(null===n||void 0===n?void 0:n.visible)&&(null===t||void 0===t||null===(e=t.find((function(e){return"idle"===e.name})))||void 0===e||e.animation.play())}),[null===n||void 0===n?void 0:n.visible])}({model:n,actions:a}),Object(m.f)((function(e,n){return null===t||void 0===t?void 0:t.update(n)}));var o=function(){var e=Object(f.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c("waving","idle");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return n?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("primitive",{object:n,dispose:null,onClick:o}),Object(r.jsx)(_,{model:n})]}):null},_=function(e){var n=e.model,t=Object(i.useRef)();return Object(m.f)((function(){if(!t.current)return null;for(var e=n.skeleton.bones[110].getWorldPosition(new b.Vector3(0,0,0)),r=t.current.children.length-1;r>0;r--)r<20?t.current.children[r].position.copy(t.current.children[0].position).lerp(e,r/20):t.current.children[r].position.copy(t.current.children[r-20].position);t.current.children[0].position.copy(e)})),Object(r.jsx)("group",{ref:t,children:Array(200).fill(1).map((function(e,n){return Object(r.jsx)(S,{count:200,index:n},n)}))})},S=function(e){var n=e.count,t=e.index,a=Object(i.useRef)();return Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("mesh",{ref:a,geometry:new b.SphereBufferGeometry(.05,4),attach:"point-material"}),Object(r.jsx)("meshBasicMaterial",{attach:"point-material",opacity:.25-.25/n*t,transparent:!0,color:"ffff88"})]})},L=function(){return Object(r.jsxs)("group",{children:[Object(r.jsx)(P,{}),Object(r.jsx)(C,{})]})},P=function(){var e=a.a.useRef();return a.a.useEffect((function(){e.current&&(e.current.shadow.bias=-.001)}),[]),Object(r.jsx)("spotLight",{castShadow:!0,color:new b.Color(9211020),position:[5,20,15],angle:.8,intensity:.7,penumbra:.8,ref:e})},C=function(){var e=a.a.useRef();return a.a.useEffect((function(){e.current&&(e.current.shadow.mapSize.x=1024,e.current.shadow.mapSize.y=1024,e.current.shadow.camera.right=20,e.current.shadow.camera.top=20,e.current.shadow.camera.left=-20,e.current.shadow.camera.bottom=-20,e.current.shadow.bias=-.001)}),[]),Object(r.jsx)("directionalLight",{castShadow:!0,color:new b.Color(9211020),position:[-15,15,20],ref:e})},E=function(){return Object(r.jsxs)("group",{children:[Object(r.jsx)(A,{}),Object(r.jsx)(B,{})]})},A=function(){return Object(r.jsx)("mesh",{geometry:new b.SphereBufferGeometry(256,32),children:Object(r.jsx)("meshBasicMaterial",{attach:"material",wireframe:!0,color:16777215})})},B=function(){return Object(r.jsx)(r.Fragment,{children:Object(r.jsx)("mesh",{receiveShadow:!0,geometry:new b.CircleBufferGeometry(50,32),rotation:[-90*Math.PI/180,0,0],children:Object(r.jsx)("meshPhongMaterial",{attach:"material",color:new b.Color(4473924),emissive:new b.Color(8738),shadowSide:b.FrontSide})})})},F=function(){var e=a.a.useRef(),n=Object(m.h)().setDefaultCamera;return a.a.useEffect((function(){e.current&&n(e.current)}),[n]),Object(r.jsx)(j.b,{fov:45,aspect:window.innerWidth/window.innerHeight,near:1,far:2e3,position:[0,15,50],ref:e})},R=t(72),M=function(){return Object(r.jsxs)(m.a,{gl2:!0,shadowMap:!0,gl:{antialias:!0},pixelRatio:window.devicePixelRatio,style:{width:window.innerWidth,height:window.innerHeight},children:[Object(r.jsx)(L,{}),Object(r.jsx)(F,{}),Object(r.jsx)(a.a.Suspense,{fallback:null,children:Object(r.jsx)(z,{})}),Object(r.jsx)(E,{})]})},z=function(){var e=Object(m.g)(v.a,"resources/muubu_miku/miku.pmx"),n=Object(m.g)(v.a,"resources/dot_miku/miku.pmx"),t=Object(m.g)(v.a,"resources/dot_miku_2020/miku.pmx"),i=Object(m.g)(v.a,"resources/dot_miku_honey_whip/miku.pmx"),c=Object(m.g)(v.a,"resources/dot_miku_star_voice/miku.pmx"),o=Object(m.h)().camera,s=a.a.useState(),u=Object(p.a)(s,2),d=u[0],j=u[1];return a.a.useEffect((function(){e.visible&&function(){var r=Object(f.a)(l.a.mark((function r(){var a,s,u,d,f,m,h,p,b,x;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=new v.a,s=new R.a,r.next=4,w(a,o,"resources/hare_hare_yukai/camera.vmd");case 4:return u=r.sent,s.add(o,{animation:u}),r.next=8,I("resources/hare_hare_yukai/music.mp3");case 8:return d=r.sent,f=d.audio,s.add(f,{delayTime:0}),r.next=13,w(a,e,"resources/hare_hare_yukai/haruhi.vmd");case 13:return m=r.sent,s.add(e,{physics:!0,animation:m}),r.next=17,w(a,n,"resources/hare_hare_yukai/asahina.vmd");case 17:return h=r.sent,s.add(n,{physics:!0,animation:h}),r.next=21,w(a,t,"resources/hare_hare_yukai/yuki.vmd");case 21:return p=r.sent,s.add(t,{physics:!0,animation:p}),r.next=25,w(a,i,"resources/hare_hare_yukai/kyon.vmd");case 25:return b=r.sent,s.add(i,{physics:!0,animation:b}),r.next=29,w(a,c,"resources/hare_hare_yukai/koizumi.vmd");case 29:x=r.sent,s.add(c,{physics:!0,animation:x}),j(s);case 32:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}()()}),[e.visible]),Object(m.f)((function(e,n){null===d||void 0===d||d.update(n)})),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("primitive",{object:e,dispose:null}),Object(r.jsx)("primitive",{object:n,dispose:null}),Object(r.jsx)("primitive",{object:t,dispose:null}),Object(r.jsx)("primitive",{object:i,dispose:null}),Object(r.jsx)("primitive",{object:c,dispose:null})]})},I=function(e){var n=new b.AudioLoader,t=new b.AudioListener;return t.position.z=1,new Promise((function(r){n.load(e,(function(e){var n=new b.Audio(t).setBuffer(e);r({audio:n,listener:t})}))}))},T=function(){return Object(r.jsx)(s.a,{children:Object(r.jsxs)(u.c,{children:[Object(r.jsx)(u.a,{exact:!0,path:"/",component:M}),Object(r.jsx)(u.a,{exact:!0,path:"/standing",component:g})]})})},W=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,99)).then((function(n){var t=n.getCLS,r=n.getFID,i=n.getFCP,a=n.getLCP,c=n.getTTFB;t(e),r(e),i(e),a(e),c(e)}))};t(97);o.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(T,{})}),document.getElementById("root")),W()}},[[98,1,2]]]);
//# sourceMappingURL=main.c264c473.chunk.js.map